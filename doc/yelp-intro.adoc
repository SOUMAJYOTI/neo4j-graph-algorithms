== Yelp Open Dataset

https://www.yelp.com/[Yelp.com] has been running https://www.yelp.com/dataset/challenge[Yelp Dataset challenge] for about five years now. 
It is a competition that encourages people to explore and research Yelp's open dataset, which contains almost 5 million reviews from over 1.1 million users on over 150,000 businesses from 12 metropolitan areas in the tenth round of the challenge. 
Over the years the dataset has become very popular with https://scholar.google.com/scholar?q=citation%3A+Yelp+Dataset&btnG=&hl=en&as_sdt=0%2C5[hundreds of academic paper] written about it.
It has well-structured and highly relational data and is therefore a great showcase for Neo4j and graph algorithms on a realistic dataset. 
We will show how to use graph algorithms on a social network of friends and how to create and analyse an inferred graph (for example, projecting a review co-occurence graph).
There is also GPS locations of the businesses, that opens the door for spatial analysis.

Check out also https://www.yelp.com/dataset/challenge/winners[past winners and their work].   


== Data

You can   https://www.yelp.com/dataset/download[get the dataset] by filling out their form.
Download the data in JSON format. 
We will use https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases[APOC plugin] to help us with importing and batching data in Neo4j.
There are 6 JSON files available (https://www.yelp.com/dataset/documentation/json[detailed documentation]). 
Photos and checkins are not the topic of our analysis, so they will not be imported.
From the other files we will import a knowledge graph of Yelp's world, that contains data about 156639 businesses, 1005693 tips from users about businesses, 4736897 reviews of businesses by users, 9489337 users total and 35444850 friend edges between them.
Depending on your setup import might take some time as _user.json_ contains data about a 10 million person social network of friends.
While _review.json_ is even bigger in size, it is mostly made up of text representing the actual review, so the import will be faster.
We also do not need the actual text, but only meta-data about them e.g. who wrote the review and how he rated a certain business, so the text will not be imported.   


== Graph Model

image::{img}/yelp_graph_model.png[]

Our graph consist of nodes labeled User, that can be friends with other users and who also write reviews or tips about certain businesses. We store all the meta-data as properties of nodes except for categories of the businesses that are represented by separate nodes labeled Category.

Graph model always depends on the application we have in mind for it.
Our application is to analyse networks with graph algorithms.
If we were to use our graph as a recommendation engine, we might construct a different graph model.
Check this http://guides.neo4j.com/sandbox/recommendations[great guide] or this https://www.youtube.com/watch?v=oMTmG4ClO5I[educational video] on how you can use Neo4j as a recommendation engine.   

== Import


.Define graph schema (constraint/index)
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=load-schema]
----


.Load businesses
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=load-business]
----

.Load tips
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=load-tip]
----

.Load reviews
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=load-review]
----
.Load users
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=load-user]
----

== Networks

=== Social network of friends

undirected, unweighted graph

9489337 users

35444850 friends edges

526460 weakly connected components

Users with no friends: 507948

Nodes in largest WCC : 8938630

Edges in largest WCC : 35420520

Prior work:

* http://snap.stanford.edu/class/cs224w-2015/projects_2015/Predicting_Yelp_Ratings_From_Social_Network_Data.pdf

* https://arxiv.org/pdf/1512.06915.pdf

* http://snap.stanford.edu/class/cs224w-2015/projects_2015/Predicting_Yelp_Ratings_Using_User_Friendship_Network_Information.pdf

=== Projecting a review co-occurence graph


4736897 reviews

so you can filter out all of those that "reviewed every business (probably bot or bored) and those that reviewed only 1-5 businesses - not enough data"
like a band-filter in information theory

Because of spam/bots/stupid you can have nodes with 1000 similar users and garbage like that



.Create a review co-occurence undirected, weighted graph, user to user
[source,cypher]
----
include::scripts/yelp-import.cypher[tag=cooccurence-graph]
----

.Create a review co-occurence undirected, weighted graph, business to business
[source,cypher]
----
----
Prior work:

* http://trust.sce.ntu.edu.sg/wit-ec16/paper/davoust.pdf

* https://www.ml.cmu.edu/research/dap-papers/DAP-He_Yilin.pdf

* http://snap.stanford.edu/class/cs224w-2013/projects2013/cs224w-038-final.pdf

=== Feature extraction 

undirected, weighted


Prior work:

=== Spatial analysis

need neo4j-spatial ?

Prior work:

* http://pub.tik.ee.ethz.ch/students/2015-FS/GA-2015-05.pdf